<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
  </head>
<!-- -->
  <script>
    var Module = {
      onRuntimeInitialized: function() {

// see: https://stackoverflow.com/questions/47313403/passing-client-files-to-webassembly-from-the-front-end
// https://stackoverflow.com/questions/61496876/how-can-i-load-a-file-from-a-html-input-into-emscriptens-memfs-file-system
// https://stackoverflow.com/questions/59128901/reading-large-user-provided-file-from-emscripten-chunk-at-a-time
        FS.createDataFile('/', 'data.txt', new Uint8Array([65, 66, 67]), true, true, true);
        FS.mkdir('/test');
//        FS.createDataFile('/test', 'data2.txt', new Uint8Array([68, 69, 70, 10, 71, 72, 73, 10]), true, true, true);
        FS.writeFile('/test/data2.txt', new Uint8Array([68, 69, 70, 10, 71, 72, 73, 10]));

        let sfr = new Module.StubFileParser();

        console.log('JS: "/data.txt" found: ' + sfr.isRecognized('/data.txt'));
        console.log('JS: "/non_existent.txt" found: ' + sfr.isRecognized('/non_existent.txt'));
        console.log('JS: "/test/data2.txt" found: ' + sfr.isRecognized('/test/data2.txt'));

        console.log('JS: =======================================================');
	let vec = new Module.vector$std$$shared_ptr$sciformats$$sciwrap$$model$$FileParser$$();
	vec.push_back(sfr);
	let frs = new Module.FileParserSelector(vec);
        console.log('JS: FileParserSelector.isRecognized("/data.txt"): ' + frs.isRecognized('/data.txt'));
        console.log('JS: FileParserSelector.isRecognized("/non_existent.txt"): ' + frs.isRecognized('/non_existent.txt'));
      }
    };
  </script>
  <script src="sciwrap_main.js"></script>
<!-- -->
  <!-- Service Worker test -->
  <script>
      const worker = new Worker("worker.js");
      function onClick() {
          const f = document.getElementById("in-file").files[0];
          worker.postMessage([ f ]);
      }
  </script>
  <body>
      <input type="file" id="in-file" />
      <input type="button" onClick="onClick()" value="Load" />
  </body>
</html>
