image: rust:1.74

before_script:
  - cd lib-rs

stages:
  - test
  - coverage
  - build
  - doc
  - publish

format:
  stage: test
  script:
    - rustup component add rustfmt
    - cargo fmt --check

lint:
  stage: test
  script:
    - rustup component add clippy
    - cargo clippy

lint:
  stage: test
  script:
    - cargo test

build:
  stage: build
  script:
    - cargo build --release
  artifacts:
    paths:
      - lib-rs/target/release

build:wasm:
  stage: build
  script:
    - rustup target add wasm32-unknown-unknown
    - cargo install wasm-pack
    - wasm-pack build
  artifacts:
    paths:
      - lib-rs/pkg

# pages:
#   stage: publish
#   script:
#     - rm -rf public
#     - mkdir public
#     - mv build/coverage public/coverage
#     - mv build/doc/html public/doc
#   dependencies:
#     - coverage:linux_gcc
#     - doc:doxygen
#   artifacts:
#     paths:
#       - public
#   only:
#     - master

